entities:
- name: environment
  namespace: laplacian.arch.deployment

  properties:
  - name: name
    type: string
    primary_key: true

  - name: tier
    type: string
    domain:
      choices:
      - value: local
      - value: development
      - value: staging
      - value: production

  - name: uses_locally_built_container_images
    type: boolean
    optional: true
    default_value: |
      listOf("development", "local").any{ it == tier }

  relationships:
  - name: component_entries
    cardinality: "*"
    reference_entity_name: component_entry
    aggregate: true

  - name: components
    cardinality: "*"
    reference_entity_name: component
    snippet: |
      componentEntries.map{ it.component }

- name: component_entry
  namespace: laplacian.arch.deployment

  properties:
  - name: name
    type: string
    primary_key: true

  relationships:
  - name: environment
    cardinality: '1'
    reference_entity_name: environment
    reverse_of: component_entries

  - name: component
    cardinality: "1"
    reference_entity_name: component
    mappings:
    - from: name
      to: name
